<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Task Details</title>
</head>
<body>

<div class="task-container">
    <h1 th:text="${task.title}">Task Title Placeholder</h1>

    <p>
        <strong>ID:</strong>
        <span th:text="${task.id}">1</span>
    </p>

    <p>
        <strong>Description:</strong>
        <br>
        <span th:text="${task.description}">Task Description</span>
    </p>

    <p>
        <strong>Price:</strong>
        <span th:text="${#numbers.formatCurrency(task.price)}">$0.00</span>
    </p>

    <p>
        <strong>Status:</strong>
        <span class="status-badge" th:classappend="'status-' + ${task.status}" th:text="${task.status}">OPEN</span>
    </p>

    <p>
        <strong>Customer ID:</strong>
        <span th:text="${task.customerId}">0</span>
    </p>

    <p>
        <strong>Contractor ID:</strong>
        <span th:if="${task.contractorId != null}" th:text="${task.contractorId}">0</span>
        <span th:unless="${task.contractorId != null}">Not yet assigned</span>
    </p>

</div>

<div th:if="${userRole=='CUSTOMER' && task.customerId == userId && task.status =='Completed'}">
    <form th:action="@{/approvetask}" method="post" th:object="${task}">
        <input type="hidden" th:field="*{id}" th:value="${task.id}"/>
        <button type="submit">Approve Task</button>
    </form>
</div>

<div th:if="${userRole=='CUSTOMER' && task.customerId == userId && (task.status == 'Open' || task.status == 'Accepted')}">
    <br>
    <form th:action="@{/canceltask}" method="post" th:object="${task}">
        <input type="hidden" th:field="*{id}" th:value="${task.id}"/>
        <button type="submit">Cancel Task</button>
    </form>
</div>

<div th:if="${userRole=='CUSTOMER' && task.customerId == userId && task.status=='Cancelled'}">
    <br>
    <form th:action="@{/reopentask}" method="post" th:object="${task}">
        <input type="hidden" th:field="*{id}" th:value="${task.id}"/>
        <button type="submit">Reopen Task</button>
    </form>
</div>

<div th:if="${userRole=='CONTRACTOR' && task.status == 'Open'}">
    <form th:action="@{/accepttask}" method="post" th:object="${task}">
        <input type="hidden" th:field="*{id}" th:value="${task.id}"/>
        <button type="submit">Accept Task</button>
    </form>
</div>

<div th:if="${userRole=='CONTRACTOR' && task.status == 'Accepted' && task.contractorId == userId}">
    <form th:action="@{/completetask}" method="post" th:object="${task}">
        <input type="hidden" th:field="*{id}" th:value="${task.id}"/>
        <button type="submit">Complete Task</button>
    </form>
</div>

<div th:if="${userRole=='CONTRACTOR' && task.contractorId == userId && task.status != 'Approved'}">
    <br>
    <form th:action="@{/reopentask}" method="post" th:object="${task}">
        <input type="hidden" th:field="*{id}" th:value="${task.id}"/>
        <button type="submit">Cancel Task</button>
    </form>
</div>

<br><br><br><br><br>
<a th:href="@{/tasks}">Return to tasks management board</a>
<br>
<a th:href="@{/}">Home</a>
</body>
</html>